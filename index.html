<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Prompt Quality Analyzer</title>
    <link rel="icon" type="image/x-icon" href="" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #0d1117;
        color: #e0e0e0;
      }
      .main-container {
        background: linear-gradient(145deg, #161b22, #0d1117);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
        animation: fadeIn 1s ease-out;
      }
      .prompt-textarea {
        background-color: rgba(13, 17, 23, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }
      .prompt-textarea:focus {
        background-color: rgba(13, 17, 23, 1);
        border-color: #58a6ff;
        box-shadow: 0 0 20px rgba(88, 166, 255, 0.3);
      }
      .analyze-btn {
        background: linear-gradient(
          45deg,
          #f72585,
          #7209b7,
          #3a0ca3,
          #4361ee
        );
        background-size: 300% 300%;
        transition: all 0.4s ease;
        box-shadow: 0 4px 15px rgba(180, 58, 226, 0.4);
        animation: gradient-animation 8s ease infinite;
      }
      .analyze-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(180, 58, 226, 0.6);
      }
      .analyze-btn:active {
        transform: translateY(0);
      }
      .score-circle {
        stroke-dasharray: 283;
        stroke-dashoffset: 283;
        transition: stroke-dashoffset 1.5s cubic-bezier(0.65, 0, 0.35, 1);
      }
      .feedback-item {
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        animation: slideInUp 0.5s ease-out forwards;
        opacity: 0;
      }
      .feedback-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: scale(1.02);
      }
      .feedback-details {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
      }
      .feedback-item.open .feedback-details {
        max-height: 500px;
      }
      .feedback-section h4 {
        font-weight: 600;
        margin-bottom: 0.25rem;
        display: flex;
        align-items: center;
      }
      .feedback-section p {
        padding-left: 1.5rem;
      }
      .loader {
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-left-color: #58a6ff;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
      }
      #results-display {
        animation: fadeIn 0.8s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes gradient-animation {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-4">
    <div class="main-container w-full max-w-5xl mx-auto p-6 md:p-8 lg:p-12">
      <header class="text-center mb-8" style="animation: fadeIn 0.5s ease-out">
        <h1 class="text-3xl md:text-4xl font-bold text-white tracking-tight">
          AI Prompt Quality Analyzer
        </h1>
        <p class="text-lg text-gray-400 mt-2">
          Evaluate and improve your prompts with detailed AI-powered feedback.
        </p>
      </header>

      <main>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="flex flex-col" style="animation: slideInUp 0.6s ease-out">
            <label
              for="prompt-input"
              class="mb-2 text-lg font-semibold text-gray-300"
              >Enter your prompt here:</label
            >
            <textarea
              id="prompt-input"
              rows="10"
              class="prompt-textarea w-full p-4 rounded-lg text-base text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="e.g., 'Create a marketing campaign for a new brand of sustainable coffee...'"
            ></textarea>
            <button
              id="analyze-btn"
              class="analyze-btn w-full mt-4 py-3 px-6 rounded-lg text-white font-semibold text-lg"
            >
              Analyze Prompt
            </button>
          </div>

          <div
            id="results-container"
            class="flex flex-col items-center justify-center p-6 rounded-lg"
            style="
              background-color: rgba(0, 0, 0, 0.2);
              border: 1px solid rgba(255, 255, 255, 0.1);
            "
          >
            <div id="initial-state" class="text-center">
              <svg
                class="w-24 h-24 text-gray-600 mx-auto mb-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
                ></path>
              </svg>
              <h2 class="text-xl font-semibold text-gray-400">
                Your analysis will appear here.
              </h2>
              <p class="text-gray-500 mt-1">
                Enter a prompt and click "Analyze" to see the results.
              </p>
            </div>

            <div id="loading-state" class="hidden text-center">
              <div class="loader mx-auto"></div>
              <p class="text-lg text-gray-400 mt-4">Analyzing your prompt...</p>
            </div>

            <div
              id="error-state"
              class="hidden text-center p-4 bg-red-900 bg-opacity-50 rounded-lg"
            >
              <p class="text-red-300 font-semibold">An error occurred.</p>
              <p id="error-message" class="text-red-400 mt-1">
                Could not analyze the prompt. Please try again.
              </p>
            </div>

            <div id="results-display" class="hidden w-full">
              <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-white mb-4">
                  Overall Score
                </h2>
                <div class="relative w-40 h-40 mx-auto">
                  <svg class="w-full h-full" viewBox="0 0 100 100">
                    <defs>
                      <linearGradient
                        id="scoreGradient"
                        x1="0%"
                        y1="0%"
                        x2="100%"
                        y2="100%"
                      >
                        <stop
                          offset="0%"
                          style="stop-color: #10b981; stop-opacity: 1"
                        />
                        <stop
                          offset="100%"
                          style="stop-color: #3b82f6; stop-opacity: 1"
                        />
                      </linearGradient>
                    </defs>
                    <circle
                      class="text-gray-700"
                      stroke-width="10"
                      cx="50"
                      cy="50"
                      r="45"
                      fill="transparent"
                      stroke="#374151"
                    ></circle>
                    <circle
                      id="score-circle-progress"
                      class="score-circle"
                      stroke-width="10"
                      cx="50"
                      cy="50"
                      r="45"
                      fill="transparent"
                      stroke-linecap="round"
                      transform="rotate(-90 50 50)"
                    ></circle>
                  </svg>
                  <div
                    class="absolute inset-0 flex flex-col items-center justify-center"
                  >
                    <span id="total-score" class="text-4xl font-bold">0</span>
                    <span id="letter-grade" class="text-lg font-semibold"
                      >F</span
                    >
                  </div>
                </div>
              </div>

              <h3 class="text-xl font-bold text-white mb-4 text-center">
                Criteria Breakdown
              </h3>
              <div id="criteria-breakdown" class="space-y-3"></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      const analyzeBtn = document.getElementById("analyze-btn");
      const promptInput = document.getElementById("prompt-input");
      const resultsContainer = document.getElementById("results-container");
      const initialState = document.getElementById("initial-state");
      const loadingState = document.getElementById("loading-state");
      const errorState = document.getElementById("error-state");
      const errorMessage = document.getElementById("error-message");
      const resultsDisplay = document.getElementById("results-display");
      const totalScoreEl = document.getElementById("total-score");
      const letterGradeEl = document.getElementById("letter-grade");
      const scoreCircleProgress = document.getElementById(
        "score-circle-progress"
      );
      const criteriaBreakdown = document.getElementById("criteria-breakdown");

      // --- IMPROVEMENT: API Key Management ---
      // Replace "YOUR_API_KEY_HERE" with your actual Google AI API key.
      const API_KEY = "AIzaSyApADMJDVHZkO8ayQLNibjpIz3yoS7ym-0";
      const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${API_KEY}`;

      analyzeBtn.addEventListener("click", handleAnalysis);

      async function handleAnalysis() {
        const userPrompt = promptInput.value.trim();
        if (!userPrompt) {
          showError("Prompt cannot be empty.");
          return;
        }

        showLoading();

        try {
          const systemPrompt = `
              You are an expert in prompt engineering. Your task is to evaluate a user's prompt based on 7 key criteria.
              For each criterion, provide:
              1. A score from 0 to 100.
              2. "what_is_wrong": A brief, specific explanation of what is lacking or incorrect.
              3. "how_to_improve": Actionable advice on how to fix the identified issue.
              4. "suggestion": A concrete example of a revised phrase or sentence.
              
              The 7 criteria are: Clarity and Specificity, Structural Coherence, Task Definition Precision, Context Provision, Role Definition, Potential Ambiguity, Actionable Instructions.
              
              Provide your analysis in this JSON structure:
              { "evaluation": [ { "criterion": "...", "score": <num>, "what_is_wrong": "...", "how_to_improve": "...", "suggestion": "..." } ] }
            `;

          const fullPrompt = `${systemPrompt}\n\nUser Prompt to Evaluate:\n"${userPrompt}"`;

          // --- FIX: Added generationConfig to ensure consistent, deterministic results ---
          const payload = {
            contents: [{ parts: [{ text: fullPrompt }] }],
            generationConfig: {
              temperature: 0, // Setting temperature to 0 removes randomness
              responseMimeType: "application/json", // Ensures the model returns valid JSON
            },
          };

          const response = await fetchWithRetry(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!response.ok) {
            const errorBody = await response.json();
            const message =
              errorBody?.error?.message || `API error: ${response.statusText}`;
            throw new Error(message);
          }

          const result = await response.json();
          // --- IMPROVEMENT: No longer need to clean up the response string ---
          const textResponse = result.candidates[0].content.parts[0].text;
          const data = JSON.parse(textResponse);

          displayResults(data);
        } catch (error) {
          console.error("Analysis failed:", error);
          showError(
            `Analysis failed. This could be due to an invalid API key or network issues. Please check the console.`
          );
        }
      }

      async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
        let lastError;
        for (let i = 0; i < retries; i++) {
          try {
            const response = await fetch(url, options);
            return response; // If we get a response, even an error one, we return it to be handled.
          } catch (error) {
            lastError = error;
            // Wait before retrying with exponential backoff
            await new Promise((resolve) =>
              setTimeout(resolve, delay * Math.pow(2, i))
            );
          }
        }
        // If all retries fail, throw the last error caught.
        throw lastError;
      }

      function displayResults(data) {
        hideAllStates();
        resultsDisplay.classList.remove("hidden");

        const totalScore = Math.round(
          data.evaluation.reduce((sum, item) => sum + item.score, 0) /
            data.evaluation.length
        );
        const grade = getLetterGrade(totalScore);
        const circleCircumference = 2 * Math.PI * 45; // 2 * pi * r
        const strokeOffset =
          circleCircumference - (totalScore / 100) * circleCircumference;

        totalScoreEl.textContent = totalScore;
        letterGradeEl.textContent = grade;
        letterGradeEl.style.color = getScoreColor(totalScore, true);
        scoreCircleProgress.style.strokeDashoffset = strokeOffset;
        scoreCircleProgress.style.stroke = getScoreColor(totalScore);

        criteriaBreakdown.innerHTML = "";
        data.evaluation.forEach((item, index) => {
          const itemEl = document.createElement("div");
          itemEl.className = "feedback-item rounded-lg p-4";
          itemEl.style.animationDelay = `${index * 100}ms`;
          const scoreColor = getScoreColor(item.score);

          itemEl.innerHTML = `
              <div class="flex justify-between items-center">
                  <span class="font-semibold">${item.criterion}</span>
                  <div class="flex items-center space-x-2">
                      <span class="font-bold" style="color: ${scoreColor};">${item.score}</span>
                      <svg class="w-5 h-5 text-gray-400 transition-transform transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                  </div>
              </div>
              <div class="feedback-details mt-3 pt-3 border-t border-gray-700 space-y-3">
                  <div class="feedback-section">
                      <h4 class="text-red-400"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>What's Wrong</h4>
                      <p class="text-gray-300">${item.what_is_wrong}</p>
                  </div>
                  <div class="feedback-section">
                      <h4 class="text-yellow-400"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>How to Improve</h4>
                      <p class="text-gray-300">${item.how_to_improve}</p>
                  </div>
                  <div class="feedback-section">
                      <h4 class="text-green-400"><svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Suggestion</h4>
                      <p class="text-gray-300 italic">"${item.suggestion}"</p>
                  </div>
              </div>
            `;
          criteriaBreakdown.appendChild(itemEl);

          itemEl.addEventListener("click", () => {
            itemEl.classList.toggle("open");
            const icon = itemEl.querySelector(
              "svg:not(.feedback-section svg)"
            );
            icon.classList.toggle("rotate-180");
          });
        });
      }

      function getScoreColor(score, isText = false) {
        if (score >= 85) return isText ? "#2dd4bf" : "#14b8a6"; // Teal
        if (score >= 60) return isText ? "#facc15" : "#eab308"; // Yellow
        return isText ? "#fb7185" : "#f43f5e"; // Rose
      }

      function getLetterGrade(score) {
        if (score >= 90) return "A+";
        if (score >= 80) return "A";
        if (score >= 70) return "B";
        if (score >= 60) return "C";
        if (score >= 50) return "D";
        return "F";
      }

      function showLoading() {
        hideAllStates();
        loadingState.classList.remove("hidden");
      }

      function showError(message) {
        hideAllStates();
        errorMessage.textContent = message;
        errorState.classList.remove("hidden");
      }

      function hideAllStates() {
        initialState.classList.add("hidden");
        loadingState.classList.add("hidden");
        errorState.classList.add("hidden");
        resultsDisplay.classList.add("hidden");
      }
    </script>
  </body>
</html>